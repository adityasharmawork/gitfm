{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 52, "column": 0}, "map": {"version":3,"sources":["file:///home/popos/Downloads/code-synth-2025-app%20%281%29/lib/session.ts"],"sourcesContent":["import crypto from \"crypto\"\n\n// Use a secret key from environment variable (must be 32 bytes for AES-256)\nconst getSecretKey = (): Buffer => {\n    const secret = process.env.SESSION_SECRET\n    if (!secret) {\n        throw new Error(\"SESSION_SECRET environment variable is required\")\n    }\n    // Create a consistent 32-byte key from the secret\n    return crypto.createHash(\"sha256\").update(secret).digest()\n}\n\nconst ALGORITHM = \"aes-256-gcm\"\nconst IV_LENGTH = 16\nconst AUTH_TAG_LENGTH = 16\n\nexport function encryptSession(data: object): string {\n    const key = getSecretKey()\n    const iv = crypto.randomBytes(IV_LENGTH)\n    const cipher = crypto.createCipheriv(ALGORITHM, key, iv)\n\n    const jsonData = JSON.stringify(data)\n    const encrypted = Buffer.concat([cipher.update(jsonData, \"utf8\"), cipher.final()])\n    const authTag = cipher.getAuthTag()\n\n    // Combine IV + AuthTag + Encrypted data, then base64 encode\n    const combined = Buffer.concat([iv, authTag, encrypted])\n    return combined.toString(\"base64\")\n}\n\nexport function decryptSession<T = unknown>(encryptedData: string): T | null {\n    try {\n        const key = getSecretKey()\n        const combined = Buffer.from(encryptedData, \"base64\")\n\n        // Extract IV, AuthTag, and encrypted data\n        const iv = combined.subarray(0, IV_LENGTH)\n        const authTag = combined.subarray(IV_LENGTH, IV_LENGTH + AUTH_TAG_LENGTH)\n        const encrypted = combined.subarray(IV_LENGTH + AUTH_TAG_LENGTH)\n\n        const decipher = crypto.createDecipheriv(ALGORITHM, key, iv)\n        decipher.setAuthTag(authTag)\n\n        const decrypted = Buffer.concat([decipher.update(encrypted), decipher.final()])\n        return JSON.parse(decrypted.toString(\"utf8\")) as T\n    } catch (error) {\n        console.error(\"Session decryption failed:\", error)\n        return null\n    }\n}\n"],"names":[],"mappings":";;;;;;AAAA;;AAEA,4EAA4E;AAC5E,MAAM,eAAe;IACjB,MAAM,SAAS,QAAQ,GAAG,CAAC,cAAc;IACzC,IAAI,CAAC,QAAQ;QACT,MAAM,IAAI,MAAM;IACpB;IACA,kDAAkD;IAClD,OAAO,gHAAM,CAAC,UAAU,CAAC,UAAU,MAAM,CAAC,QAAQ,MAAM;AAC5D;AAEA,MAAM,YAAY;AAClB,MAAM,YAAY;AAClB,MAAM,kBAAkB;AAEjB,SAAS,eAAe,IAAY;IACvC,MAAM,MAAM;IACZ,MAAM,KAAK,gHAAM,CAAC,WAAW,CAAC;IAC9B,MAAM,SAAS,gHAAM,CAAC,cAAc,CAAC,WAAW,KAAK;IAErD,MAAM,WAAW,KAAK,SAAS,CAAC;IAChC,MAAM,YAAY,OAAO,MAAM,CAAC;QAAC,OAAO,MAAM,CAAC,UAAU;QAAS,OAAO,KAAK;KAAG;IACjF,MAAM,UAAU,OAAO,UAAU;IAEjC,4DAA4D;IAC5D,MAAM,WAAW,OAAO,MAAM,CAAC;QAAC;QAAI;QAAS;KAAU;IACvD,OAAO,SAAS,QAAQ,CAAC;AAC7B;AAEO,SAAS,eAA4B,aAAqB;IAC7D,IAAI;QACA,MAAM,MAAM;QACZ,MAAM,WAAW,OAAO,IAAI,CAAC,eAAe;QAE5C,0CAA0C;QAC1C,MAAM,KAAK,SAAS,QAAQ,CAAC,GAAG;QAChC,MAAM,UAAU,SAAS,QAAQ,CAAC,WAAW,YAAY;QACzD,MAAM,YAAY,SAAS,QAAQ,CAAC,YAAY;QAEhD,MAAM,WAAW,gHAAM,CAAC,gBAAgB,CAAC,WAAW,KAAK;QACzD,SAAS,UAAU,CAAC;QAEpB,MAAM,YAAY,OAAO,MAAM,CAAC;YAAC,SAAS,MAAM,CAAC;YAAY,SAAS,KAAK;SAAG;QAC9E,OAAO,KAAK,KAAK,CAAC,UAAU,QAAQ,CAAC;IACzC,EAAE,OAAO,OAAO;QACZ,QAAQ,KAAK,CAAC,8BAA8B;QAC5C,OAAO;IACX;AACJ"}},
    {"offset": {"line": 114, "column": 0}, "map": {"version":3,"sources":["file:///home/popos/Downloads/code-synth-2025-app%20%281%29/app/api/auth/session/route.ts"],"sourcesContent":["import { type NextRequest, NextResponse } from \"next/server\"\nimport { decryptSession } from \"@/lib/session\"\n\ninterface SessionData {\n  accessToken: string\n  username: string\n  avatarUrl: string\n  name: string | null\n}\n\nexport async function GET(request: NextRequest) {\n  const sessionCookie = request.cookies.get(\"github_session\")?.value\n\n  if (!sessionCookie) {\n    return NextResponse.json({ authenticated: false })\n  }\n\n  try {\n    const sessionData = decryptSession<SessionData>(sessionCookie)\n\n    if (!sessionData) {\n      return NextResponse.json({ authenticated: false })\n    }\n\n    return NextResponse.json({\n      authenticated: true,\n      user: {\n        username: sessionData.username,\n        avatarUrl: sessionData.avatarUrl,\n        name: sessionData.name,\n      },\n    })\n  } catch {\n    return NextResponse.json({ authenticated: false })\n  }\n}\n\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AASO,eAAe,IAAI,OAAoB;IAC5C,MAAM,gBAAgB,QAAQ,OAAO,CAAC,GAAG,CAAC,mBAAmB;IAE7D,IAAI,CAAC,eAAe;QAClB,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,eAAe;QAAM;IAClD;IAEA,IAAI;QACF,MAAM,cAAc,IAAA,kIAAc,EAAc;QAEhD,IAAI,CAAC,aAAa;YAChB,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,eAAe;YAAM;QAClD;QAEA,OAAO,gJAAY,CAAC,IAAI,CAAC;YACvB,eAAe;YACf,MAAM;gBACJ,UAAU,YAAY,QAAQ;gBAC9B,WAAW,YAAY,SAAS;gBAChC,MAAM,YAAY,IAAI;YACxB;QACF;IACF,EAAE,OAAM;QACN,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,eAAe;QAAM;IAClD;AACF"}}]
}