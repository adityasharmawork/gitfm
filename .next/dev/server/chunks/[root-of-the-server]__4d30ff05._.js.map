{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 52, "column": 0}, "map": {"version":3,"sources":["file:///home/popos/Downloads/code-synth-2025-app%20%281%29/lib/session.ts"],"sourcesContent":["import crypto from \"crypto\"\n\n// Use a secret key from environment variable (must be 32 bytes for AES-256)\nconst getSecretKey = (): Buffer => {\n    const secret = process.env.SESSION_SECRET\n    if (!secret) {\n        throw new Error(\"SESSION_SECRET environment variable is required\")\n    }\n    // Create a consistent 32-byte key from the secret\n    return crypto.createHash(\"sha256\").update(secret).digest()\n}\n\nconst ALGORITHM = \"aes-256-gcm\"\nconst IV_LENGTH = 16\nconst AUTH_TAG_LENGTH = 16\n\nexport function encryptSession(data: object): string {\n    const key = getSecretKey()\n    const iv = crypto.randomBytes(IV_LENGTH)\n    const cipher = crypto.createCipheriv(ALGORITHM, key, iv)\n\n    const jsonData = JSON.stringify(data)\n    const encrypted = Buffer.concat([cipher.update(jsonData, \"utf8\"), cipher.final()])\n    const authTag = cipher.getAuthTag()\n\n    // Combine IV + AuthTag + Encrypted data, then base64 encode\n    const combined = Buffer.concat([iv, authTag, encrypted])\n    return combined.toString(\"base64\")\n}\n\nexport function decryptSession<T = unknown>(encryptedData: string): T | null {\n    try {\n        const key = getSecretKey()\n        const combined = Buffer.from(encryptedData, \"base64\")\n\n        // Extract IV, AuthTag, and encrypted data\n        const iv = combined.subarray(0, IV_LENGTH)\n        const authTag = combined.subarray(IV_LENGTH, IV_LENGTH + AUTH_TAG_LENGTH)\n        const encrypted = combined.subarray(IV_LENGTH + AUTH_TAG_LENGTH)\n\n        const decipher = crypto.createDecipheriv(ALGORITHM, key, iv)\n        decipher.setAuthTag(authTag)\n\n        const decrypted = Buffer.concat([decipher.update(encrypted), decipher.final()])\n        return JSON.parse(decrypted.toString(\"utf8\")) as T\n    } catch (error) {\n        console.error(\"Session decryption failed:\", error)\n        return null\n    }\n}\n"],"names":[],"mappings":";;;;;;AAAA;;AAEA,4EAA4E;AAC5E,MAAM,eAAe;IACjB,MAAM,SAAS,QAAQ,GAAG,CAAC,cAAc;IACzC,IAAI,CAAC,QAAQ;QACT,MAAM,IAAI,MAAM;IACpB;IACA,kDAAkD;IAClD,OAAO,gHAAM,CAAC,UAAU,CAAC,UAAU,MAAM,CAAC,QAAQ,MAAM;AAC5D;AAEA,MAAM,YAAY;AAClB,MAAM,YAAY;AAClB,MAAM,kBAAkB;AAEjB,SAAS,eAAe,IAAY;IACvC,MAAM,MAAM;IACZ,MAAM,KAAK,gHAAM,CAAC,WAAW,CAAC;IAC9B,MAAM,SAAS,gHAAM,CAAC,cAAc,CAAC,WAAW,KAAK;IAErD,MAAM,WAAW,KAAK,SAAS,CAAC;IAChC,MAAM,YAAY,OAAO,MAAM,CAAC;QAAC,OAAO,MAAM,CAAC,UAAU;QAAS,OAAO,KAAK;KAAG;IACjF,MAAM,UAAU,OAAO,UAAU;IAEjC,4DAA4D;IAC5D,MAAM,WAAW,OAAO,MAAM,CAAC;QAAC;QAAI;QAAS;KAAU;IACvD,OAAO,SAAS,QAAQ,CAAC;AAC7B;AAEO,SAAS,eAA4B,aAAqB;IAC7D,IAAI;QACA,MAAM,MAAM;QACZ,MAAM,WAAW,OAAO,IAAI,CAAC,eAAe;QAE5C,0CAA0C;QAC1C,MAAM,KAAK,SAAS,QAAQ,CAAC,GAAG;QAChC,MAAM,UAAU,SAAS,QAAQ,CAAC,WAAW,YAAY;QACzD,MAAM,YAAY,SAAS,QAAQ,CAAC,YAAY;QAEhD,MAAM,WAAW,gHAAM,CAAC,gBAAgB,CAAC,WAAW,KAAK;QACzD,SAAS,UAAU,CAAC;QAEpB,MAAM,YAAY,OAAO,MAAM,CAAC;YAAC,SAAS,MAAM,CAAC;YAAY,SAAS,KAAK;SAAG;QAC9E,OAAO,KAAK,KAAK,CAAC,UAAU,QAAQ,CAAC;IACzC,EAAE,OAAO,OAAO;QACZ,QAAQ,KAAK,CAAC,8BAA8B;QAC5C,OAAO;IACX;AACJ"}},
    {"offset": {"line": 114, "column": 0}, "map": {"version":3,"sources":["file:///home/popos/Downloads/code-synth-2025-app%20%281%29/app/api/auth/github/callback/route.ts"],"sourcesContent":["import { type NextRequest, NextResponse } from \"next/server\"\nimport { encryptSession } from \"@/lib/session\"\n\nconst GITHUB_CLIENT_ID = process.env.GITHUB_CLIENT_ID!\nconst GITHUB_CLIENT_SECRET = process.env.GITHUB_CLIENT_SECRET!\n\nexport async function GET(request: NextRequest) {\n  const searchParams = request.nextUrl.searchParams\n  const code = searchParams.get(\"code\")\n  const state = searchParams.get(\"state\")\n  const storedState = request.cookies.get(\"github_oauth_state\")?.value\n\n  // Verify state to prevent CSRF\n  if (!state || state !== storedState) {\n    return NextResponse.redirect(new URL(\"/?error=invalid_state\", request.url))\n  }\n\n  if (!code) {\n    return NextResponse.redirect(new URL(\"/?error=no_code\", request.url))\n  }\n\n  try {\n    // Exchange code for access token\n    const tokenResponse = await fetch(\"https://github.com/login/oauth/access_token\", {\n      method: \"POST\",\n      headers: {\n        \"Content-Type\": \"application/json\",\n        Accept: \"application/json\",\n      },\n      body: JSON.stringify({\n        client_id: GITHUB_CLIENT_ID,\n        client_secret: GITHUB_CLIENT_SECRET,\n        code,\n      }),\n    })\n\n    const tokenData = await tokenResponse.json()\n\n    if (tokenData.error) {\n      console.error(\"OAuth error:\", tokenData.error_description)\n      return NextResponse.redirect(new URL(`/?error=${tokenData.error}`, request.url))\n    }\n\n    const accessToken = tokenData.access_token\n\n    // Fetch user info to get the username\n    const userResponse = await fetch(\"https://api.github.com/user\", {\n      headers: {\n        Authorization: `Bearer ${accessToken}`,\n        Accept: \"application/vnd.github.v3+json\",\n      },\n    })\n\n    const userData = await userResponse.json()\n\n    if (!userResponse.ok) {\n      return NextResponse.redirect(new URL(\"/?error=user_fetch_failed\", request.url))\n    }\n\n    // Create response and set session cookie\n    const response = NextResponse.redirect(new URL(\"/\", request.url))\n\n    // Encrypt session data (includes access token securely)\n    const encryptedSession = encryptSession({\n      accessToken,\n      username: userData.login,\n      avatarUrl: userData.avatar_url,\n      name: userData.name,\n    })\n\n    response.cookies.set(\"github_session\", encryptedSession, {\n      httpOnly: true,\n      secure: process.env.NODE_ENV === \"production\",\n      sameSite: \"lax\",\n      maxAge: 60 * 60 * 24, // 24 hours\n      path: \"/\",\n    })\n\n    // Clear the OAuth state cookie\n    response.cookies.delete(\"github_oauth_state\")\n\n    return response\n  } catch (error) {\n    console.error(\"OAuth callback error:\", error)\n    return NextResponse.redirect(new URL(\"/?error=callback_failed\", request.url))\n  }\n}\n\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAEA,MAAM,mBAAmB,QAAQ,GAAG,CAAC,gBAAgB;AACrD,MAAM,uBAAuB,QAAQ,GAAG,CAAC,oBAAoB;AAEtD,eAAe,IAAI,OAAoB;IAC5C,MAAM,eAAe,QAAQ,OAAO,CAAC,YAAY;IACjD,MAAM,OAAO,aAAa,GAAG,CAAC;IAC9B,MAAM,QAAQ,aAAa,GAAG,CAAC;IAC/B,MAAM,cAAc,QAAQ,OAAO,CAAC,GAAG,CAAC,uBAAuB;IAE/D,+BAA+B;IAC/B,IAAI,CAAC,SAAS,UAAU,aAAa;QACnC,OAAO,gJAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,yBAAyB,QAAQ,GAAG;IAC3E;IAEA,IAAI,CAAC,MAAM;QACT,OAAO,gJAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,mBAAmB,QAAQ,GAAG;IACrE;IAEA,IAAI;QACF,iCAAiC;QACjC,MAAM,gBAAgB,MAAM,MAAM,+CAA+C;YAC/E,QAAQ;YACR,SAAS;gBACP,gBAAgB;gBAChB,QAAQ;YACV;YACA,MAAM,KAAK,SAAS,CAAC;gBACnB,WAAW;gBACX,eAAe;gBACf;YACF;QACF;QAEA,MAAM,YAAY,MAAM,cAAc,IAAI;QAE1C,IAAI,UAAU,KAAK,EAAE;YACnB,QAAQ,KAAK,CAAC,gBAAgB,UAAU,iBAAiB;YACzD,OAAO,gJAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,CAAC,QAAQ,EAAE,UAAU,KAAK,EAAE,EAAE,QAAQ,GAAG;QAChF;QAEA,MAAM,cAAc,UAAU,YAAY;QAE1C,sCAAsC;QACtC,MAAM,eAAe,MAAM,MAAM,+BAA+B;YAC9D,SAAS;gBACP,eAAe,CAAC,OAAO,EAAE,aAAa;gBACtC,QAAQ;YACV;QACF;QAEA,MAAM,WAAW,MAAM,aAAa,IAAI;QAExC,IAAI,CAAC,aAAa,EAAE,EAAE;YACpB,OAAO,gJAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,6BAA6B,QAAQ,GAAG;QAC/E;QAEA,yCAAyC;QACzC,MAAM,WAAW,gJAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,KAAK,QAAQ,GAAG;QAE/D,wDAAwD;QACxD,MAAM,mBAAmB,IAAA,kIAAc,EAAC;YACtC;YACA,UAAU,SAAS,KAAK;YACxB,WAAW,SAAS,UAAU;YAC9B,MAAM,SAAS,IAAI;QACrB;QAEA,SAAS,OAAO,CAAC,GAAG,CAAC,kBAAkB,kBAAkB;YACvD,UAAU;YACV,QAAQ,oDAAyB;YACjC,UAAU;YACV,QAAQ,KAAK,KAAK;YAClB,MAAM;QACR;QAEA,+BAA+B;QAC/B,SAAS,OAAO,CAAC,MAAM,CAAC;QAExB,OAAO;IACT,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,yBAAyB;QACvC,OAAO,gJAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,2BAA2B,QAAQ,GAAG;IAC7E;AACF"}}]
}