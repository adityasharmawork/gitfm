{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///home/popos/Downloads/code-synth-2025-app%20%281%29/app/api/auth/github/callback/route.ts"],"sourcesContent":["import { type NextRequest, NextResponse } from \"next/server\"\n\nconst GITHUB_CLIENT_ID = process.env.GITHUB_CLIENT_ID!\nconst GITHUB_CLIENT_SECRET = process.env.GITHUB_CLIENT_SECRET!\n\nexport async function GET(request: NextRequest) {\n  const searchParams = request.nextUrl.searchParams\n  const code = searchParams.get(\"code\")\n  const state = searchParams.get(\"state\")\n  const storedState = request.cookies.get(\"github_oauth_state\")?.value\n\n  // Verify state to prevent CSRF\n  if (!state || state !== storedState) {\n    return NextResponse.redirect(new URL(\"/?error=invalid_state\", request.url))\n  }\n\n  if (!code) {\n    return NextResponse.redirect(new URL(\"/?error=no_code\", request.url))\n  }\n\n  try {\n    // Exchange code for access token\n    const tokenResponse = await fetch(\"https://github.com/login/oauth/access_token\", {\n      method: \"POST\",\n      headers: {\n        \"Content-Type\": \"application/json\",\n        Accept: \"application/json\",\n      },\n      body: JSON.stringify({\n        client_id: GITHUB_CLIENT_ID,\n        client_secret: GITHUB_CLIENT_SECRET,\n        code,\n      }),\n    })\n\n    const tokenData = await tokenResponse.json()\n\n    if (tokenData.error) {\n      console.error(\"OAuth error:\", tokenData.error_description)\n      return NextResponse.redirect(new URL(`/?error=${tokenData.error}`, request.url))\n    }\n\n    const accessToken = tokenData.access_token\n\n    // Fetch user info to get the username\n    const userResponse = await fetch(\"https://api.github.com/user\", {\n      headers: {\n        Authorization: `Bearer ${accessToken}`,\n        Accept: \"application/vnd.github.v3+json\",\n      },\n    })\n\n    const userData = await userResponse.json()\n\n    if (!userResponse.ok) {\n      return NextResponse.redirect(new URL(\"/?error=user_fetch_failed\", request.url))\n    }\n\n    // Create response and set session cookie\n    const response = NextResponse.redirect(new URL(\"/\", request.url))\n\n    // Store session data in cookie (no sensitive tokens - only user info for display)\n    const sessionData = JSON.stringify({\n      username: userData.login,\n      avatarUrl: userData.avatar_url,\n      name: userData.name,\n    })\n\n    // Base64 encode the session\n    const encodedSession = Buffer.from(sessionData).toString(\"base64\")\n\n    response.cookies.set(\"github_session\", encodedSession, {\n      httpOnly: true,\n      secure: process.env.NODE_ENV === \"production\",\n      sameSite: \"lax\",\n      maxAge: 60 * 60 * 24, // 24 hours\n      path: \"/\",\n    })\n\n    // Clear the OAuth state cookie\n    response.cookies.delete(\"github_oauth_state\")\n\n    return response\n  } catch (error) {\n    console.error(\"OAuth callback error:\", error)\n    return NextResponse.redirect(new URL(\"/?error=callback_failed\", request.url))\n  }\n}\n"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM,mBAAmB,QAAQ,GAAG,CAAC,gBAAgB;AACrD,MAAM,uBAAuB,QAAQ,GAAG,CAAC,oBAAoB;AAEtD,eAAe,IAAI,OAAoB;IAC5C,MAAM,eAAe,QAAQ,OAAO,CAAC,YAAY;IACjD,MAAM,OAAO,aAAa,GAAG,CAAC;IAC9B,MAAM,QAAQ,aAAa,GAAG,CAAC;IAC/B,MAAM,cAAc,QAAQ,OAAO,CAAC,GAAG,CAAC,uBAAuB;IAE/D,+BAA+B;IAC/B,IAAI,CAAC,SAAS,UAAU,aAAa;QACnC,OAAO,gJAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,yBAAyB,QAAQ,GAAG;IAC3E;IAEA,IAAI,CAAC,MAAM;QACT,OAAO,gJAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,mBAAmB,QAAQ,GAAG;IACrE;IAEA,IAAI;QACF,iCAAiC;QACjC,MAAM,gBAAgB,MAAM,MAAM,+CAA+C;YAC/E,QAAQ;YACR,SAAS;gBACP,gBAAgB;gBAChB,QAAQ;YACV;YACA,MAAM,KAAK,SAAS,CAAC;gBACnB,WAAW;gBACX,eAAe;gBACf;YACF;QACF;QAEA,MAAM,YAAY,MAAM,cAAc,IAAI;QAE1C,IAAI,UAAU,KAAK,EAAE;YACnB,QAAQ,KAAK,CAAC,gBAAgB,UAAU,iBAAiB;YACzD,OAAO,gJAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,CAAC,QAAQ,EAAE,UAAU,KAAK,EAAE,EAAE,QAAQ,GAAG;QAChF;QAEA,MAAM,cAAc,UAAU,YAAY;QAE1C,sCAAsC;QACtC,MAAM,eAAe,MAAM,MAAM,+BAA+B;YAC9D,SAAS;gBACP,eAAe,CAAC,OAAO,EAAE,aAAa;gBACtC,QAAQ;YACV;QACF;QAEA,MAAM,WAAW,MAAM,aAAa,IAAI;QAExC,IAAI,CAAC,aAAa,EAAE,EAAE;YACpB,OAAO,gJAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,6BAA6B,QAAQ,GAAG;QAC/E;QAEA,yCAAyC;QACzC,MAAM,WAAW,gJAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,KAAK,QAAQ,GAAG;QAE/D,kFAAkF;QAClF,MAAM,cAAc,KAAK,SAAS,CAAC;YACjC,UAAU,SAAS,KAAK;YACxB,WAAW,SAAS,UAAU;YAC9B,MAAM,SAAS,IAAI;QACrB;QAEA,4BAA4B;QAC5B,MAAM,iBAAiB,OAAO,IAAI,CAAC,aAAa,QAAQ,CAAC;QAEzD,SAAS,OAAO,CAAC,GAAG,CAAC,kBAAkB,gBAAgB;YACrD,UAAU;YACV,QAAQ,oDAAyB;YACjC,UAAU;YACV,QAAQ,KAAK,KAAK;YAClB,MAAM;QACR;QAEA,+BAA+B;QAC/B,SAAS,OAAO,CAAC,MAAM,CAAC;QAExB,OAAO;IACT,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,yBAAyB;QACvC,OAAO,gJAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,2BAA2B,QAAQ,GAAG;IAC7E;AACF"}}]
}